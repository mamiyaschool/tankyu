<!doctype html>
<html lang="ja" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¢ç©¶ã‚¹ã‚­ãƒ«ã‚«ãƒ¼ãƒ‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700&amp;family=Zen+Maru+Gothic:wght@400;500;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      font-family: 'M PLUS Rounded 1c', sans-serif;
    }
    
    .title-font {
      font-family: 'Zen Maru Gothic', sans-serif;
    }
    
    .card-container {
      perspective: 1500px;
    }
    
    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      transform-style: preserve-3d;
    }
    
    .card-inner.flipped {
      transform: rotateY(180deg);
    }
    
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 0;
      overflow: hidden;
      border: 4px solid #d4af37;
      box-shadow: 0 0 20px rgba(212, 175, 55, 0.4), inset 0 0 20px rgba(212, 175, 55, 0.1);
    }
    
    .card-back {
      transform: rotateY(180deg);
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes rotate-bg {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .float-animation {
      animation: float 3s ease-in-out infinite;
    }
    
    .rotate-bg {
      animation: rotate-bg 20s linear infinite;
    }
    
    @keyframes draw-card {
      0% { transform: scale(0.8) rotateY(180deg); opacity: 0; }
      50% { transform: scale(1.05) rotateY(90deg); opacity: 1; }
      100% { transform: scale(1) rotateY(0deg); opacity: 1; }
    }
    
    .draw-animation {
      animation: draw-card 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }
    
    .toast {
      animation: slideIn 0.3s ease-out, fadeOut 0.3s ease-in 2.7s forwards;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    
    .my-card-item {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
    }
    
    .my-card-item:hover {
      transform: translateY(-8px) rotate(0deg) !important;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      z-index: 10;
    }
    
    .grid-card-item {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
    }
    
    .grid-card-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #374151, #4b5563);
      transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
      background: linear-gradient(135deg, #4b5563, #6b7280);
      transform: translateY(-2px);
    }
    
    .btn-gold {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      transition: all 0.3s ease;
    }
    
    .btn-gold:hover {
      background: linear-gradient(135deg, #d97706, #b45309);
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(245, 158, 11, 0.3);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      transition: all 0.3s ease;
    }
    
    .btn-danger:hover {
      background: linear-gradient(135deg, #dc2626, #b91c1c);
    }
    
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 3px;
    }
    
    .loading-spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: #ffd700;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .popup-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      animation: fadeIn 0.2s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .popup-card {
      position: relative;
      width: 100%;
      max-width: 400px;
      min-height: 600px;
      border-radius: 0;
      overflow: visible;
      border: 4px solid #d4af37;
      box-shadow: 0 0 30px rgba(212, 175, 55, 0.5), 0 25px 50px rgba(0, 0, 0, 0.5);
      animation: popupScale 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      transform-origin: center;
      background: #fcfcfc;
    }
    
    @keyframes popupScale {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    .popup-close {
      position: absolute;
      top: -8px;
      right: -8px;
      width: 32px;
      height: 32px;
      background: rgba(239, 68, 68, 0.95);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      z-index: 9999;
      transition: all 0.2s ease;
      border: 2px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    
    .popup-close:hover {
      background: rgba(239, 68, 68, 1);
      transform: scale(1.1);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
    }
    
    /* ãƒã‚¤ã‚«ãƒ¼ãƒ‰ã®å‰Šé™¤ãƒœã‚¿ãƒ³ï¼ˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã¨åŒã˜ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ */
    button[data-delete] {
      transition: all 0.2s ease;
    }
    
    button[data-delete]:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4) !important;
    }
    
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gradient-to-br from-[#0a0a0a] to-[#1a1a1a] text-white overflow-auto">
  <div id="app" class="min-h-full w-full p-4 md:p-8">
   <div id="toast-container" class="fixed top-4 right-4 z-50 flex flex-col gap-2"></div>
   <header class="text-center mb-8">
    <h1 id="app-title" class="title-font text-3xl md:text-4xl font-bold bg-gradient-to-r from-yellow-400 via-orange-400 to-yellow-400 bg-clip-text text-transparent">æ¢ç©¶ã‚¹ã‚­ãƒ«ã‚«ãƒ¼ãƒ‰</h1>
    <p class="text-gray-400 mt-2">ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã„ã¦æ¢ç©¶ã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ã‚ˆã†</p>
   </header>
   <main class="max-w-6xl mx-auto">
    <section class="mb-8">
     <div class="flex flex-wrap justify-center gap-4 mb-4">
      <button id="draw-sample-btn" class="btn-gold text-white font-bold py-3 px-6 rounded-xl shadow-lg">ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã</button>
     </div>
     <div class="flex justify-center mb-6">
      <div class="bg-gray-900/50 rounded-xl p-3 inline-flex flex-wrap gap-2 items-center"><span class="text-sm text-gray-400 mr-2">ğŸ¯ å±æ€§çµã‚Šè¾¼ã¿:</span> <button class="category-filter-btn active bg-yellow-600 hover:bg-yellow-700 text-white text-sm font-medium py-1.5 px-4 rounded-lg transition-all" data-category="all">ã™ã¹ã¦</button> <button class="category-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium py-1.5 px-4 rounded-lg transition-all" data-category="æ€è€ƒï¼ˆæ¯”è¼ƒç³»ï¼‰">â–  æ¯”è¼ƒç³»</button> <button class="category-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium py-1.5 px-4 rounded-lg transition-all" data-category="æ€è€ƒï¼ˆåˆ†è§£â†”çµ±åˆç³»ï¼‰">â–² åˆ†è§£çµ±åˆç³»</button> <button class="category-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium py-1.5 px-4 rounded-lg transition-all" data-category="æ€è€ƒï¼ˆå¤šé¢ãƒ»å¤šè§’ç³»ï¼‰">â— å¤šé¢å¤šè§’ç³»</button> <button class="category-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium py-1.5 px-4 rounded-lg transition-all" data-category="æ€è€ƒï¼ˆç‰¹æ®Šç³»ï¼‰">â˜… ç‰¹æ®Šç³»</button> <button class="category-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium py-1.5 px-4 rounded-lg transition-all" data-category="å­¦ã³æ–¹">â™¤ å­¦ã³æ–¹</button> <button class="category-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium py-1.5 px-4 rounded-lg transition-all" data-category="è¨€èª">â™§ è¨€èª</button> <button class="category-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium py-1.5 px-4 rounded-lg transition-all" data-category="æƒ…å ±">â™¢ æƒ…å ±</button> <button class="category-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium py-1.5 px-4 rounded-lg transition-all" data-category="å”åƒ">â™¡ å”åƒ</button>
      </div>
     </div>
     <div class="mx-auto w-full max-w-sm">
     <div id="card-area" class="block w-full">
      <div id="card-placeholder" class="block w-full h-[600px] overflow-hidden border-4 border-[#d4af37] shadow-lg rounded-none relative" style="box-shadow: 0 0 20px rgba(212, 175, 55, 0.4), inset 0 0 20px rgba(212, 175, 55, 0.1);">
        <img id="card-placeholder-back-img" class="absolute left-0 top-1/2 z-10 -translate-y-1/2 w-full h-auto max-h-none" alt="ã‚«ãƒ¼ãƒ‰è£" style="display: none; min-width: 100%;">
        <div id="card-placeholder-back-fallback" class="h-full w-full bg-gradient-to-br from-amber-950 via-amber-900 to-stone-900 flex flex-col items-center justify-center relative overflow-hidden">
          <div class="absolute inset-0 opacity-10">
            <div class="rotate-bg absolute inset-[-50%] w-[200%] h-[200%]">
              <div class="w-full h-full" style="background: repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(255,215,0,0.3) 20px, rgba(255,215,0,0.3) 40px);"></div>
            </div>
          </div>
          <div class="float-animation text-8xl mb-4 relative z-10">ğŸ”</div>
          <p class="title-font text-2xl font-bold bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent relative z-10">æ¢ç©¶ã‚«ãƒ¼ãƒ‰</p>
          <p class="text-yellow-500/70 text-sm mt-2 relative z-10">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã“ã†ï¼</p>
          <div class="absolute top-4 left-4 text-yellow-500/50 text-2xl">âœ¦</div>
          <div class="absolute top-4 right-4 text-yellow-500/50 text-2xl">âœ¦</div>
          <div class="absolute bottom-4 left-4 text-yellow-500/50 text-2xl">âœ¦</div>
          <div class="absolute bottom-4 right-4 text-yellow-500/50 text-2xl">âœ¦</div>
        </div>
      </div>
      <div id="card-display" class="hidden card-container w-full h-[600px]">
       <div id="card-inner" class="card-inner">
       <div id="card-front" class="card-front">
        <div class="h-full flex flex-col overflow-hidden">
         <div class="relative flex flex-col flex-shrink-0 overflow-hidden" style="height: 70%;">
          <div class="absolute top-3 right-4 z-10">
           <span id="card-category" class="backdrop-blur px-4 py-1.5 rounded-full text-sm font-bold text-white shadow-lg"></span>
          </div>
          <div class="flex-1 flex items-center justify-center px-4 pt-2 pb-1 bg-white/10" style="min-height: 0;">
           <div id="card-image-container" class="w-full h-full flex items-center justify-center">
            <img id="card-image" class="max-w-full max-h-full w-auto h-auto object-contain" alt="ã‚¹ã‚­ãƒ«ã‚¤ãƒ©ã‚¹ãƒˆ">
           </div>
          </div>
          <div class="text-center px-6 py-1 flex flex-col justify-end" style="min-height: 64px; flex-shrink: 0;">
           <h2 id="card-name" class="title-font text-2xl md:text-3xl font-bold text-gray-800"></h2>
           <p id="card-formal-name" class="title-font text-base md:text-lg text-gray-600 mt-0.5"></p>
          </div>
         </div>
         <div class="border-t-3 border-[#d4af37]" style="border-top-width: 3px; flex-shrink: 0;"></div>
         <div class="flex flex-col flex-shrink-0 overflow-hidden" style="height: 30%;">
          <div class="flex-1 flex items-center justify-center text-center px-6 py-3" style="min-height: 0;">
           <p id="card-description" class="text-base leading-relaxed text-gray-700"></p>
          </div>
          <div class="px-4 pb-4" style="flex-shrink: 0;">
           <div class="bg-gray-800 rounded-xl p-3 border border-gray-600">
            <p class="text-xs text-gray-300 mb-1 font-medium">ğŸ¯ ã‚¹ã‚­ãƒ«ä¾‹</p>
            <p id="card-hint" class="text-sm text-gray-100"></p>
           </div>
          </div>
         </div>
        </div>
        <div class="card-back relative border-4 border-amber-400/60" style="background: #1c1917;">
         <img id="card-back-img" class="absolute left-0 top-1/2 -translate-y-1/2 w-full h-auto max-h-none" alt="ã‚«ãƒ¼ãƒ‰è£" style="display: none; min-width: 100%;">
         <div id="card-back-fallback" class="h-full w-full bg-gradient-to-br from-amber-950 via-amber-900 to-stone-900 flex flex-col items-center justify-center relative overflow-hidden">
          <div class="absolute inset-0 opacity-10">
           <div class="rotate-bg absolute inset-[-50%] w-[200%] h-[200%]">
            <div class="w-full h-full" style="background: repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(255,215,0,0.3) 20px, rgba(255,215,0,0.3) 40px);"></div>
           </div>
          </div>
          <div class="float-animation text-8xl mb-4">ğŸ”</div>
          <p class="title-font text-2xl font-bold bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent">æ¢ç©¶ã‚«ãƒ¼ãƒ‰</p>
          <div class="absolute top-4 left-4 text-yellow-500/50 text-2xl">âœ¦</div>
          <div class="absolute top-4 right-4 text-yellow-500/50 text-2xl">âœ¦</div>
          <div class="absolute bottom-4 left-4 text-yellow-500/50 text-2xl">âœ¦</div>
          <div class="absolute bottom-4 right-4 text-yellow-500/50 text-2xl">âœ¦</div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <div id="card-actions" class="hidden block w-full mt-5 flex flex-row justify-center gap-3">
      <button id="add-to-hand-btn" class="btn-gold text-white text-sm font-medium py-2 px-4 rounded-lg">ãƒã‚¤ã‚«ãƒ¼ãƒ‰ã«åŠ ãˆã‚‹</button>
      <button id="return-to-deck-btn" class="btn-secondary text-white text-sm font-medium py-2 px-4 rounded-lg">é•ã†ã‚«ãƒ¼ãƒ‰ã«ã™ã‚‹</button>
     </div>
     </div>
    </section>
    <section id="hand-section" class="mb-8">
     <div class="flex items-center justify-between mb-4 flex-wrap gap-3">
      <h2 class="title-font text-xl font-bold flex items-center gap-2"><span>âœ¨</span> <span id="my-cards-label">ãƒã‚¤ã‚«ãƒ¼ãƒ‰</span> <span id="hand-count" class="text-sm font-normal text-gray-400"></span></h2>
      <div class="flex gap-2 flex-wrap">
        <label class="bg-gray-700 hover:bg-gray-600 text-white text-xs py-1.5 px-3 rounded-lg transition-all cursor-pointer">ğŸ“‚ èª­ã¿è¾¼ã¿ <input type="file" id="import-hand-file" accept=".csv,.json" class="hidden"></label>
        <button id="export-hand-json" class="bg-gray-700 hover:bg-gray-600 text-white text-xs py-1.5 px-3 rounded-lg transition-all">ğŸ’¾ ãƒã‚¤ã‚«ãƒ¼ãƒ‰ä¿å­˜</button>
      </div>
     </div>
     <div id="hand-cards" class="flex flex-wrap gap-6 justify-center md:justify-start">
      <div id="hand-empty" class="w-full text-center text-gray-500 py-8">
       ã¾ã ãƒã‚¤ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“
      </div>
     </div>
    </section>
    <div class="space-y-4">
     <section class="bg-gray-900/50 rounded-2xl overflow-hidden"><button id="all-cards-toggle" class="w-full p-4 flex items-center justify-between text-left hover:bg-gray-800/50 transition-colors"> <h2 class="title-font text-xl font-bold flex items-center gap-2"><span>ğŸ´</span> <span>ã™ã¹ã¦ã®ã‚«ãƒ¼ãƒ‰ä¸€è¦§</span> <span id="all-cards-count" class="text-sm font-normal text-gray-400"></span></h2><span id="all-cards-arrow" class="text-2xl transition-transform">â–¼</span> </button>
      <div id="all-cards-content" class="hidden p-4 pt-0 border-t border-gray-800">
       <div class="mb-4 flex justify-center">
        <div class="bg-gray-800/50 rounded-lg p-2 inline-flex flex-wrap gap-2"><button class="all-cards-filter-btn active bg-purple-600 hover:bg-purple-700 text-white text-xs py-1.5 px-3 rounded transition-all" data-filter="all">ã™ã¹ã¦</button> <button class="all-cards-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-xs py-1.5 px-3 rounded transition-all" data-filter="æ€è€ƒï¼ˆæ¯”è¼ƒç³»ï¼‰">â–  æ¯”è¼ƒç³»</button> <button class="all-cards-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-xs py-1.5 px-3 rounded transition-all" data-filter="æ€è€ƒï¼ˆåˆ†è§£â†”çµ±åˆç³»ï¼‰">â–² åˆ†è§£çµ±åˆç³»</button> <button class="all-cards-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-xs py-1.5 px-3 rounded transition-all" data-filter="æ€è€ƒï¼ˆå¤šé¢ãƒ»å¤šè§’ç³»ï¼‰">â— å¤šé¢å¤šè§’ç³»</button> <button class="all-cards-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-xs py-1.5 px-3 rounded transition-all" data-filter="æ€è€ƒï¼ˆç‰¹æ®Šç³»ï¼‰">â˜… ç‰¹æ®Šç³»</button> <button class="all-cards-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-xs py-1.5 px-3 rounded transition-all" data-filter="å­¦ã³æ–¹">â™¤ å­¦ã³æ–¹</button> <button class="all-cards-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-xs py-1.5 px-3 rounded transition-all" data-filter="è¨€èª">â™§ è¨€èª</button> <button class="all-cards-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-xs py-1.5 px-3 rounded transition-all" data-filter="æƒ…å ±">â™¢ æƒ…å ±</button> <button class="all-cards-filter-btn bg-gray-700 hover:bg-gray-600 text-white text-xs py-1.5 px-3 rounded transition-all" data-filter="å”åƒ">â™¡ å”åƒ</button>
        </div>
       </div>
       <div id="all-cards-grid" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3"></div>
      </div>
     </section>
    </div>
   </main>
   <div id="loading-overlay" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50">
    <div class="flex flex-col items-center gap-3">
     <div class="loading-spinner"></div>
     <p class="text-yellow-400">èª­ã¿è¾¼ã¿ä¸­...</p>
    </div>
   </div>
   <div id="popup-overlay" class="hidden popup-overlay">
    <div class="popup-card relative">
     <button class="popup-close" id="popup-close" aria-label="é–‰ã˜ã‚‹">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
     </button>
     <div id="popup-card-content" class="h-full flex flex-col overflow-hidden rounded-none">
      <div class="relative flex flex-col" style="height: 70%; min-height: 420px;">
       <div class="absolute top-3 right-4 z-10">
        <span id="popup-category" class="backdrop-blur px-4 py-1.5 rounded-full text-sm font-bold text-white shadow-lg"></span>
       </div>
       <div class="flex-1 flex items-center justify-center px-4 pt-2 pb-1 bg-white/10" style="min-height: 0;">
        <div id="popup-image-container" class="w-full h-full flex items-center justify-center"><img id="popup-image" class="max-w-full max-h-full w-auto h-auto object-contain" alt="ã‚¹ã‚­ãƒ«ã‚¤ãƒ©ã‚¹ãƒˆ" loading="lazy" onerror="console.error('Image failed to load:', this.src); this.style.display='none';">
        </div>
       </div>
       <div class="text-center px-6 py-1 flex flex-col justify-end" style="min-height: 64px; flex-shrink: 0;">
        <h2 id="popup-name" class="title-font text-2xl md:text-3xl font-bold text-gray-800"></h2>
        <p id="popup-formal-name" class="title-font text-base md:text-lg text-gray-600 mt-0.5"></p>
       </div>
      </div>
      <div class="border-t-3 border-[#d4af37]" style="border-top-width: 3px; flex-shrink: 0;"></div>
      <div class="flex flex-col" style="height: 30%; min-height: 180px;">
       <div class="flex-1 flex items-center justify-center text-center px-6 py-3" style="min-height: 0;">
        <p id="popup-description" class="text-base leading-relaxed text-gray-700"></p>
       </div>
       <div class="px-4 pb-4" style="flex-shrink: 0;">
        <div class="bg-gray-800 rounded-xl p-3 border border-gray-600">
         <p class="text-xs text-gray-300 mb-1 font-medium">ğŸ¯ ã‚¹ã‚­ãƒ«ä¾‹</p>
         <p id="popup-hint" class="text-sm text-gray-100"></p>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      app_title: 'æ¢ç©¶ã‚¹ã‚­ãƒ«ã‚«ãƒ¼ãƒ‰',
      draw_sample_btn: 'ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã',
      draw_registered_btn: 'ã‚«ãƒ¼ãƒ‰ã‚’å¼•ã',
      add_to_hand_btn: 'ãƒã‚¤ã‚«ãƒ¼ãƒ‰ã«åŠ ãˆã‚‹',
      return_to_deck_btn: 'é•ã†ã‚«ãƒ¼ãƒ‰ã«ã™ã‚‹',
      my_cards_label: 'ãƒã‚¤ã‚«ãƒ¼ãƒ‰',
      card_back_image_url: 'https://mamiyaschool.github.io/tankyu/%E3%82%AB%E3%83%BC%E3%83%89%E8%A3%8F%E9%9D%A2.png'
    };

    const sampleCards = [
  {
    "skill_name": "ã‹ã•ãªã‚Šç™ºè¦‹ãƒŸãƒ©ãƒ¼",
    "formal_name": "æ€è€ƒ",
    "skill_category": "æ€è€ƒï¼ˆæ¯”è¼ƒç³»ï¼‰",
    "description": "è¤‡æ•°ã®ã‚‚ã®ã‚’æ˜ ã—å‡ºã™ã¨ã€åŒã˜éƒ¨åˆ†ãŒãƒ“ã‚«ãƒƒã¨é‡ãªã‚Šã€é•ã†éƒ¨åˆ†ãŒå·¦å³ã«é£›ã³å‡ºã—ã¦è¦‹ãˆã‚‹é­”æ³•ã®æ‰‹é¡",
    "hint": "ã€Œç¸„æ–‡æ™‚ä»£ã€ã¨ã€Œå¼¥ç”Ÿæ™‚ä»£ã€ã‚’æ¯”ã¹ã¦ã€ä½ã‚€å ´æ‰€ã‚„é£Ÿã¹ç‰©ç­‰ã®è¦–ç‚¹ã‹ã‚‰é•ã„ã‚„å…±é€šç‚¹ã‚’æ•´ç†ã™ã‚‹ç­‰",
    "shape": "â– ",
    "color": "orange",
    "image_url": "https://www.city.moriguchi.osaka.jp/material/images/group/54/kasanari.png"
  },
  {
    "skill_name": "ã¤ãªãŒã‚Šãƒã‚°ãƒãƒƒãƒˆ",
    "skill_category": "æ€è€ƒï¼ˆæ¯”è¼ƒç³»ï¼‰",
    "description": "é›¢ã‚Œã¦ã„ã‚‹æƒ…å ±åŒå£«ã‚’ç£çŸ³ã®ã‚ˆã†ã«å¼•ãå¯„ã›ã€ã©ã‚“ãªé–¢ä¿‚ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’è¦‹ã¤ã‘ã‚‹é“å…·",
    "hint": "åœ°å½¢ã¨äººã€…ã®ãã‚‰ã—ã‚’ã¤ãªã„ã§ãªãœãã“ã«ç”ºãŒã§ããŸã‹è€ƒãˆã‚‹ã€æ°—ã¥ãã‚’å‡ºã—åˆã£ã¦é–¢ä¿‚ã™ã‚‹ã‚‚ã®åŒå£«ã‚’ã¤ãªã’ã¦æ•´ç†ã™ã‚‹ç­‰",
    "shape": "â– ",
    "color": "orange",
    "image_url": "https://www.city.moriguchi.osaka.jp/material/images/group/54/tunagari.png"
  },
  {
    "skill_name": "åˆ†é¡ãƒãƒƒãƒˆ",
    "skill_category": "æ€è€ƒï¼ˆæ¯”è¼ƒç³»ï¼‰",
    "description": "å…±é€šç‚¹ã«æ³¨ç›®ã—ã¦ã€ãƒãƒ©ãƒãƒ©ãªæƒ…å ±ã‚’ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«ã™ãã„ä¸Šã’ã‚‹ãƒãƒƒãƒˆ",
    "hint": "èª¿ã¹ãŸæƒ…å ±ã‚’ã€Œäº‹å®Ÿï¼ˆè¦‹ãŸã“ã¨ï¼‰ã€ã¨ã€Œæ„è¦‹ï¼ˆè€ƒãˆãŸã“ã¨ï¼‰ã€ã«åˆ†ã‘ã‚‹ã€è‹±å˜èªã‚’ã€Œåè©ã€ã€Œå‹•è©ã€ã€Œå½¢å®¹è©ã€ç­‰ã§åˆ†ã‘ã‚‹ç­‰",
    "shape": "â– ",
    "color": "orange",
    "image_url": "https://www.city.moriguchi.osaka.jp/material/images/group/54/bunrui.png"
  },
  {
    "skill_name": "ãƒŠãƒ³ãƒãƒ¼ãƒã‚µãƒŸ",
    "skill_category": "æ€è€ƒï¼ˆåˆ†è§£â†”çµ±åˆç³»ï¼‰",
    "description": "è¤‡é›‘ãªã‚‚ã®ã‚’ç´°ã‹ãåˆ†ã‘ãŸã‚Šã€æ§‹é€ ã‚„ãƒ—ãƒ­ã‚»ã‚¹ã®æ„å‘³ã‚’æ•´ãˆç›´ã—ãŸã‚Šã™ã‚‹é“å…·",
    "hint": "ç‰©èªã‚’ã€Œã¯ã˜ã‚ãƒ»ä¸­ãƒ»çµ‚ã‚ã‚Šã€ã®æ®µéšã«åˆ†ã‘ã¦æ•´ç†ã™ã‚‹ã€æ–‡ã‚’è¨€è‘‰ã®ãƒ‘ãƒ¼ãƒ„ã«åˆ‡ã‚Šåˆ†ã‘ã¦æ­£ã—ã„ä¸¦ã³é †ã‚’è€ƒãˆã‚‹ç­‰",
    "shape": "â–²",
    "color": "blue",
    "image_url": "https://www.city.moriguchi.osaka.jp/material/images/group/54/number.png"
  },
  {
    "skill_name": "å‚¾å‘ã‚¹ã‚­ãƒ£ãƒŠãƒ¼",
    "skill_category": "æ€è€ƒï¼ˆåˆ†è§£â†”çµ±åˆç³»ï¼‰",
    "description": "è¡¨ã‚„ã‚°ãƒ©ãƒ•ã€æ•°å€¤ã‚„äº‹ä¾‹ãªã©ã®æƒ…å ±ã‚’èª­ã¿å–ã‚Šã€å…±é€šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„ã€å…¨ä½“ã®å‚¾å‘ï¼ˆå¢—æ¸›ç­‰ï¼‰ã‚’è¦‹ã¤ã‘å‡ºã™é“å…·",
    "hint": "æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦æ™‚é–“ã®çµŒéã¨ã¨ã‚‚ã«æ•°å€¤ãŒã©ã†å¤‰åŒ–ã—ãŸã‹èª­ã¿å–ã‚‹ç­‰",
    "shape": "â–²",
    "color": "blue",
    "image_url": "https://www.city.moriguchi.osaka.jp/material/images/group/54/henko.png"
  },
  {
    "skill_name": "ã ã„ã˜ã—ã¼ã‚Šæ©Ÿ",
    "skill_category": "æ€è€ƒï¼ˆåˆ†è§£â†”çµ±åˆç³»ï¼‰",
    "description": "å¯¾è±¡ã®ä¸­ã‹ã‚‰å¤§äº‹ãªè¦ç´ ã‚„æ³•å‰‡ã€åŸç†ç­‰ã‚’ã—ã¼ã‚Šå‡ºã™é“å…·",
    "hint": "ã‚¯ãƒ©ã‚¹ã¿ã‚“ãªã®æ„è¦‹ã‹ã‚‰å…±é€šã™ã‚‹ã€Œä¸€ç•ªå¤§äº‹ãªãƒ«ãƒ¼ãƒ«ã€ã‚’æŠœãå‡ºã™ã€‚ç‰©èªã®ä¸»äººå…¬ã®å…·ä½“çš„ãªè¡Œå‹•ã‚„ç™ºè¨€ç­‰ã®æå†™ã‹ã‚‰æ€§æ ¼ã‚’è€ƒãˆã‚‹ç­‰",
    "shape": "â–²",
    "color": "blue",
    "image_url": "https://www.city.moriguchi.osaka.jp/material/images/group/54/daiji.png"
  },
  {
    "skill_name": "æ·±æ˜ã‚Šãƒ‰ãƒªãƒ«",
    "skill_category": "æ€è€ƒï¼ˆåˆ†è§£â†”çµ±åˆç³»ï¼‰",
    "description": "åœ°é¢ã‚’æ˜ã‚‹ã‚ˆã†ã«ã€Œãªãœï¼Ÿã€ã€Œã©ã†ã—ã¦ï¼Ÿã€ã¨ç†ç”±ã‚„æ ¹æ‹ ã€äºˆæƒ³ã‚’æ¢ã‚‹ãƒ‰ãƒªãƒ«",
    "hint": "ã€Œãªãœã‚·ãƒ¥ãƒ¼ãƒˆãŒå…¥ã‚‰ãªã‹ã£ãŸã®ã‹ï¼Ÿã€ã¨ã„ã†åŸå› ã‚’è¶³ã®å‘ãã‚„ãƒœãƒ¼ãƒ«ã‚’è¹´ã‚‹å ´æ‰€ç­‰ã‹ã‚‰æ·±æ˜ã‚Šã™ã‚‹ç­‰",
    "shape": "â–²",
    "color": "blue",
    "image_url": "image.png"
  },
  {
    "skill_name": "æ§‹é€ åŒ–ãƒœãƒ³ãƒ‰",
    "skill_category": "æ€è€ƒï¼ˆåˆ†è§£â†”çµ±åˆç³»ï¼‰",
    "description": "ãƒãƒ©ãƒãƒ©ã®è€ƒãˆç­‰ã‚’ã€ç¶²ã®ç›®ã‚„ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ã®ã‚ˆã†ãªå½¢ã«ãƒ“ã‚¿ãƒƒã¨ãã£ã¤ã‘ã¦æ•´ç†ã™ã‚‹ãƒœãƒ³ãƒ‰",
    "hint": "å­¦ç´šä¼šã®ä¿‚æ´»å‹•ã‚’ã€èª°ãŒãƒ»ã©ã“ã§ä½•ã‚’ã™ã‚‹ã‹ã¨ã„ã†ã€Œçµ„ç¹”ã®å›³ã€ã«ã—ã¦æ•´ç†ã™ã‚‹ç­‰",
    "shape": "â–²",
    "color": "blue",
    "image_url": "https://www.city.moriguchi.osaka.jp/material/images/group/54/kouzouka.png"
  },
  {
    "skill_name": "ã¤ã¶ã¤ã¶ã‚¹ãƒ—ãƒ¬ãƒ¼",
    "skill_category": "æ€è€ƒï¼ˆåˆ†è§£â†”çµ±åˆç³»ï¼‰",
    "description": "å¯¾è±¡ã«ã‹ã‘ã‚‹ã¨ã€ãã‚ŒãŒå…·ä½“çš„ãªä¾‹ã‚„è¦ç´ ã«åˆ†ã‹ã‚Œã¦ã€è©³ã—ãè¦‹ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã‚¹ãƒ—ãƒ¬ãƒ¼",
    "hint": "ã€Œã«ãã‚„ã‹ãªéŸ³ã€ã‚’ã€ã€Œãƒ©ãƒƒãƒ‘ã®ãƒ—ãƒƒãƒ—ãƒ¼ã¨ã„ã†éŸ³ã€ç­‰ã¨å…·ä½“çš„ã«æ›¸ãå‡ºã™ã€éŠã³ã®å…·ä½“ä¾‹ã‚’è€ƒãˆã‚‹",
    "shape": "â–²",
    "color": "blue",
    "image_url": "https://www.city.moriguchi.osaka.jp/material/images/group/54/gutai.png"
  },
  {
    "skill_name": "äº”æ„Ÿãƒ¬ãƒ¼ãƒ€ãƒ¼",
    "skill_category": "æ€è€ƒï¼ˆå¤šé¢ãƒ»å¤šè§’ç³»ï¼‰",
    "description": "äº”æ„Ÿï¼ˆè¦‹ãŸç›®ãƒ»éŸ³ãƒ»ã«ãŠã„ãƒ»æ„Ÿè§¦ãƒ»å‘³ç­‰ï¼‰ã®ã‚¢ãƒ³ãƒ†ãƒŠã§ã€æƒ…å ±ã‚’ã‚­ãƒ£ãƒƒãƒã™ã‚‹ãƒ¬ãƒ¼ãƒ€ãƒ¼",
    "hint": "æ–™ç†ã®ãƒ¬ãƒãƒ¼ãƒˆã§ã€Œã‚·ãƒ£ã‚­ã‚·ãƒ£ã‚­ã—ãŸæ­¯ã”ãŸãˆã€ã€Œé¦™ã°ã—ã„ã‹ãŠã‚Šã€ç­‰ã‚’è¨˜éŒ²ã™ã‚‹ç­‰",
    "shape": "â—",
    "color": "pink",
    "image_url": ""
  },
  {
    "skill_name": "ç«‹å ´ãƒã‚§ãƒ³ã‚¸å¸½å­",
    "skill_category": "æ€è€ƒï¼ˆå¤šé¢ãƒ»å¤šè§’ç³»ï¼‰",
    "description": "ã‹ã¶ã‚‹ã ã‘ã§ã€è‡ªåˆ†ãƒ»ç›¸æ‰‹ãƒ»ç¬¬ä¸‰è€…ãªã©ã¨ã€é•ã†ç«‹å ´ã«ãªã£ã¦è€ƒãˆã‚‰ã‚Œã‚‹å¸½å­",
    "hint": "ãƒ‰ãƒƒã‚¸ãƒœãƒ¼ãƒ«ã®ãƒ«ãƒ¼ãƒ«ã«ã¤ã„ã¦ã€ã€Œå¼·ã„å­ã€ã¨ã€Œè‹¦æ‰‹ãªå­ã€ã®ä¸¡æ–¹ã®è¦–ç‚¹ã‹ã‚‰ã¿ã‚“ãªãŒæ¥½ã—ã‚ã‚‹ãƒ«ãƒ¼ãƒ«ã‚’è€ƒãˆã‚‹ç­‰",
    "shape": "â—",
    "color": "pink",
    "image_url": ""
  },
  {
    "skill_name": "æ•™ç§‘ãƒœãƒƒã‚¯ã‚¹",
    "skill_category": "æ€è€ƒï¼ˆå¤šé¢ãƒ»å¤šè§’ç³»ï¼‰",
    "description": "å¯¾è±¡ã‚’ä¸­ã«å…¥ã‚Œã‚‹ã¨ã€ã‚¿ãƒƒãƒãƒ‘ãƒãƒ«ã§é¸ã‚“ã æ•™ç§‘ã®è¦‹æ–¹ãƒ»è€ƒãˆæ–¹ã§æ˜ ã—å‡ºã•ã‚Œã‚‹ä¸æ€è­°ãªç«‹æ–¹ä½“",
    "hint": "ç®—æ•°ãƒ¬ãƒ³ã‚ºï¼šå­¦æ ¡ã®éšæ®µã‚’ã€Œæ®µæ•°ã‚„è§’åº¦ã€ç­‰ã®æ•°å­—ã§æ‰ãˆã¦è¦‹ã¦ã¿ã‚‹ç­‰",
    "shape": "â—",
    "color": "pink",
    "image_url": ""
  },
  {
    "skill_name": "ç½®ãæ›ãˆã‚¹ã‚¤ãƒƒãƒ",
    "skill_category": "æ€è€ƒï¼ˆå¤šé¢ãƒ»å¤šè§’ç³»ï¼‰",
    "description": "ã€Œã‚‚ã—ï½ãªã‚‰ï¼Ÿã€ã€Œç°¡å˜ãªæ•°ãªã‚‰ï¼Ÿã€ã¨ã€å ´é¢ã‚„æ¡ä»¶ã‚’åˆ‡ã‚Šæ›¿ãˆã¦è€ƒãˆã‚„ã™ãã—ãŸã‚Šã€è€ƒãˆã‚’åºƒã’ãŸã‚Šã™ã‚‹ã‚¹ã‚¤ãƒƒãƒ",
    "hint": "åˆ†æ•°ã‚„å°æ•°ã®å•é¡Œã«å‡ºä¼šã£ãŸæ™‚ã€Œç°¡å˜ãªæ•´æ•°ã€ã«ç½®ãæ›ãˆã¦è§£ãæ–¹ã‚’è€ƒãˆã‚‹ç­‰",
    "shape": "â—",
    "color": "pink",
    "image_url": ""
  },
  {
    "skill_name": "ã‚¿ã‚¤ãƒ ãƒ¯ãƒ¼ãƒ—ã‚¹ã‚³ãƒ¼ãƒ—",
    "skill_category": "æ€è€ƒï¼ˆå¤šé¢ãƒ»å¤šè§’ç³»ï¼‰",
    "description": "ã€Œéå»ãƒ»ç¾åœ¨ãƒ»æœªæ¥ã€ã®æ™‚é–“ã‚’ã®ããè¾¼ã¿ã€ãã‚Œãã‚Œã®æ™‚ä»£ã®æ§˜å­ã‚’æ˜ ã™æœ›é é¡",
    "hint": "ã€Œä»Šã®æ­Œã€ã¨ã€Œ100å¹´å‰ã®æ­Œã€ã‚’è´ãæ¯”ã¹ã¦ãƒªã‚ºãƒ ã‚„æ­Œè©ã®å¤‰åŒ–ã‚’æ„Ÿã˜å–ã‚‹ç­‰",
    "shape": "â—",
    "color": "pink",
    "image_url": ""
  },
  {
    "skill_name": "å¤šèª­ãƒ¡ã‚¬ãƒ",
    "skill_category": "è¨€èª",
    "description": "æ–‡ç« ã®è¦ç‚¹ã‚„æ§‹é€ ã‚’æ‰ãˆã€å†…å®¹ã‚’æ­£ã—ãæ·±ãç†è§£ã™ã‚‹ãŸã‚ã®èª­è§£ã‚µãƒãƒ¼ãƒˆãƒ¡ã‚¬ãƒ",
    "hint": "æ–‡ç« ã®è¦ç‚¹ã‚„æ§‹é€ ã‚’ç†è§£ã—ã€å†…å®¹ã‚’æ­£ã—ãæ·±ãç†è§£ã™ã‚‹ãŸã‚ã«æ´»ç”¨ã™ã‚‹",
    "shape": "â™§",
    "color": "green",
    "image_url": ""
  },
  {
    "skill_name": "è™¹è‰²ã‚¤ãƒ³ã‚¯ã®ãƒšãƒ³",
    "skill_category": "è¨€èª",
    "description": "è€ƒãˆã‚„æƒ…å ±ã‚’æ•´ç†ã—ã€ç›®çš„ã‚„ç›¸æ‰‹ã«å¿œã˜ãŸæ–‡ç« ã§è¡¨ç¾ã™ã‚‹åŠ›ã‚’è‚²ã¦ã‚‹ã‚«ãƒ©ãƒ•ãƒ«ãªãƒšãƒ³",
    "hint": "ç›®çš„ã‚„ç›¸æ‰‹ã«å¿œã˜ãŸæ–‡ç« ã§è¡¨ç¾ã—ã€è€ƒãˆã‚„æƒ…å ±ã‚’æ•´ç†ã—ã¦ä¼ãˆã‚‹",
    "shape": "â™§",
    "color": "green",
    "image_url": ""
  },
  {
    "skill_name": "éŸ¿ãæ¸¡ã‚‹ãƒã‚¤ã‚¯",
    "skill_category": "è¨€èª",
    "description": "è€ƒãˆã‚’æ•´ç†ã—ã€ç›¸æ‰‹ã«ä¼ã‚ã‚‹ã‚ˆã†é †åºã‚„è¨€è‘‰ã‚’é¸ã‚“ã§è©±ã™åŠ›ã‚’é«˜ã‚ã‚‹ç™ºä¿¡ã®ãƒã‚¤ã‚¯",
    "hint": "è€ƒãˆã‚’æ•´ç†ã—ã€ç›¸æ‰‹ã«ä¼ã‚ã‚‹ã‚ˆã†ã«è¨€è‘‰ã‚’é¸ã‚“ã§ç™ºä¿¡ã™ã‚‹",
    "shape": "â™§",
    "color": "green",
    "image_url": ""
  },
  {
    "skill_name": "é­”æ³•ã®ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ",
    "skill_category": "æƒ…å ±",
    "description": "å¿…è¦ãªæƒ…å ±ã‚’é›†ã‚ã¦æ¯”ã¹ã€æ•´ç†ã—ãªãŒã‚‰ã€å­¦ç¿’ã‚„èª²é¡Œè§£æ±ºã«åŠ¹æœçš„ã«ç”Ÿã‹ã™é“å…·",
    "hint": "å¿…è¦ãªæƒ…å ±ã‚’é›†ã‚ã€æ•´ç†ãƒ»åˆ†æã—ã¦å­¦ç¿’ã‚„èª²é¡Œè§£æ±ºã«æ´»ç”¨ã™ã‚‹",
    "shape": "â™¢",
    "color": "lightblue",
    "image_url": ""
  },
  {
    "skill_name": "çŸ¥æµãƒŠãƒ“ãƒ©ãƒ³ã‚¿ãƒ³",
    "skill_category": "æƒ…å ±",
    "description": "æƒ…å ±ã®çœŸå½ã‚„ãƒãƒŠãƒ¼ã€ãƒªã‚¹ã‚¯ã‚’è¦‹æ¥µã‚ã€å®‰å…¨ã§è²¬ä»»ã‚ã‚‹è¡Œå‹•ã¸å°ããŸã‚ã®ãƒ©ãƒ³ã‚¿ãƒ³",
    "hint": "æƒ…å ±ã®çœŸå½ã‚„ãƒãƒŠãƒ¼ã‚’è¦‹æ¥µã‚ã€å®‰å…¨ã«æƒ…å ±ã‚’æ´»ç”¨ã™ã‚‹",
    "shape": "â™¢",
    "color": "lightblue",
    "image_url": ""
  },
  {
    "skill_name": "ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼ãƒãƒˆãƒ³",
    "skill_category": "å”åƒ",
    "description": "æ•¬æ„ã¨å‚¾è´ã‚’æ”¯ãˆã€æ„è¦‹ã‚’è¦‹ãˆã‚‹åŒ–ã—ã¦ã€é•ã„ã‚’çµ„ã¿åˆã‚ã›ã¦å¯¾è©±ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹é­”æ³•ã®ãƒãƒˆãƒ³",
    "hint": "é•ã„ã‚’çµ„ã¿åˆã‚ã›ã¦å¯¾è©±ã‚’ã‚µãƒãƒ¼ãƒˆã—ã€äº’ã„ã®æ„è¦‹ã‚’å°Šé‡ã—ã¦å­¦ã¶",
    "shape": "â™¡",
    "color": "yellow",
    "image_url": ""
  },
  {
    "skill_name": "è‡ªåˆ†ã‚¨ãƒ³ã‚¸ãƒ³ãƒãƒ‹ãƒ¥ã‚¢ãƒ«",
    "skill_category": "å­¦ã³æ–¹",
    "description": "è‡ªåˆ†ã®å¾—æ„ãƒ»è‹¦æ‰‹ã‚„å­¦ã³æ–¹ã®ç‰¹å¾´ã‚’çŸ¥ã‚Šã€æœ€é©ãªå­¦ç¿’æ–¹æ³•ã‚’é¸ã¶ãŸã‚ã®æ‰‹å¼•ãæ›¸",
    "hint": "è‡ªåˆ†ã®å­¦ã³æ–¹ã®ç‰¹å¾´ã‚’çŸ¥ã‚Šã€æœ€é©ãªå­¦ç¿’æ–¹æ³•ã‚’è‡ªåˆ†ã§é¸æŠã™ã‚‹",
    "shape": "â™¤",
    "color": "red",
    "image_url": ""
  },
  {
    "skill_name": "ãƒªãƒˆãƒ©ã‚¤ã‚¹ãƒ‹ãƒ¼ã‚«ãƒ¼",
    "skill_category": "å­¦ã³æ–¹",
    "description": "å¤±æ•—ã®è¡æ’ƒã‚’å¸åã—ã¦å†æŒ‘æˆ¦ã®åŠ›ã«å¤‰ãˆã€è“„ç©ã—ãŸå­¦ã³ã‚’ãƒ–ãƒ¼ã‚¹ãƒˆã•ã›ã¦æˆé•·ã®å£ã‚’é§†ã‘ä¸ŠãŒã‚‹é­”æ³•ã®ã‚¹ãƒ‹ãƒ¼ã‚«ãƒ¼",
    "hint": "å¤±æ•—ã‚’æã‚Œãšã«æŒ‘æˆ¦ã—ã€è“„ç©ã—ãŸå­¦ã³ã‚’æˆé•·ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã«å¤‰ãˆã‚‹",
    "shape": "â™¤",
    "color": "red",
    "image_url": ""
  }
];

    const colorGradients = {
      orange: 'linear-gradient(135deg, #f97316, #fb923c, #fdba74)',
      blue: 'linear-gradient(135deg, #3b82f6, #60a5fa, #93c5fd)',
      pink: 'linear-gradient(135deg, #ec4899, #f472b6, #f9a8d4)',
      purple: 'linear-gradient(135deg, #8b5cf6, #a78bfa, #c4b5fd)',
      red: 'linear-gradient(135deg, #ef4444, #f87171, #fca5a5)',
      green: 'linear-gradient(135deg, #10b981, #34d399, #6ee7b7)',
      cyan: 'linear-gradient(135deg, #06b6d4, #22d3ee, #67e8f9)',
      yellow: 'linear-gradient(135deg, #eab308, #facc15, #fde047)'
    };
    // å±æ€§ã”ã¨ã®è‰²ã‚’æŒ‡å®š
const CATEGORY_BACKGROUNDS = {
  'æ€è€ƒï¼ˆæ¯”è¼ƒç³»ï¼‰': '#FFEDD5',      // è–„ã„ã‚ªãƒ¬ãƒ³ã‚¸
  'æ€è€ƒï¼ˆåˆ†è§£â†”çµ±åˆç³»ï¼‰': '#DBEAFE', // è–„ã„é’
  'æ€è€ƒï¼ˆå¤šé¢ãƒ»å¤šè§’ç³»ï¼‰': '#FCE7F3', // è–„ã„ãƒ”ãƒ³ã‚¯
  'æ€è€ƒï¼ˆç‰¹æ®Šç³»ï¼‰': '#EDE9FE',      // è–„ã„ç´«
  'å­¦ã³æ–¹': '#FEE2E2',             // è–„ã„èµ¤
  'è¨€èª': '#DCFCE7',               // è–„ã„ç·‘
  'æƒ…å ±': '#CFFAFE',               // è–„ã„æ°´è‰²
  'å”åƒ': '#FEF9C3'                // è–„ã„é»„è‰²
};
    // ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ã®çµ±ä¸€è¨­å®šï¼ˆãƒã‚¤ã‚«ãƒ¼ãƒ‰ãƒ»ã‚«ãƒ¼ãƒ‰ä¸€è¦§ã§å…±é€šï¼‰
    const CARD_DESIGN = {
      background: '#f97316',
      border: '3px solid #d4af37',
      borderGrid: '2px solid #d4af37',
      boxShadow: '0 0 15px rgba(212, 175, 55, 0.3), 0 20px 40px rgba(0, 0, 0, 0.3)',
      boxShadowGrid: '0 0 10px rgba(212, 175, 55, 0.2), 0 4px 8px rgba(0, 0, 0, 0.2)',
      nameClass: 'text-gray-800',
      descClass: 'text-gray-700'
    };

    function createCardHtml(card, options = {}) {
      // ã‚µã‚¤ã‚ºã¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®šï¼ˆgrid/hand ãªã©ã‹ã‚‰æ±ºå®šï¼‰
      const size = options.size || 'hand'; // 'hand' | 'grid'
      // ãƒã‚¤ã‚«ãƒ¼ãƒ‰ãƒ»ä¸€è¦§ã‚«ãƒ¼ãƒ‰ã¯ã™ã¹ã¦ãƒŸãƒ‹æ‰±ã„ã«ã™ã‚‹
      const isMini = options.isMini !== undefined ? options.isMini : true;
      const showDelete = options.showDelete || options.showDeleteButton || false;

      // ã‚µã‚¤ã‚ºã”ã¨ã®èª¿æ•´ï¼ˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ãƒ™ãƒ¼ã‚¹ã«ç¸®å°ï¼‰
      const categoryFont = size === 'grid' ? 'text-[8px]' : 'text-[9px]';
      const nameFont = size === 'grid' ? 'text-[11px]' : 'text-sm';
      const categoryPadding = 'px-2';
      const nameAreaPadding = 'px-1 pb-1';
      const titleHeight = size === 'grid' ? '26px' : '32px';

      // èª¬æ˜ãƒ»ã‚¹ã‚­ãƒ«ä¾‹ç”¨ã‚¯ãƒ©ã‚¹ï¼ˆä¸€è¦§ã¯ã•ã‚‰ã«å°ã•ãï¼‰
      const descClass = size === 'grid'
        ? 'text-[8px] leading-snug line-clamp-2'
        : 'text-[9px] leading-snug line-clamp-2';

      const skillBoxPadding = size === 'grid' ? 'p-1' : 'p-1.5';
      const skillLabelClass = size === 'grid'
        ? 'text-[7px]'
        : 'text-[8px]';
      const skillTextClass = size === 'grid'
        ? 'text-[7px] leading-snug line-clamp-1'
        : 'text-[8px] leading-snug line-clamp-2';

      // ãƒ‡ãƒ¼ã‚¿äº’æ›ï¼ˆbackend ç”±æ¥ãªã©ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åå·®ç•°ã«å¯¾å¿œï¼‰
      const imageUrl = card.image_url || card.skill_image_url || '';
      const description = card.description || card.skill_description || '';
      const hint = card.hint || '';

      // ã‚¤ãƒ©ã‚¹ãƒˆï¼ˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã¨åŒã˜ä¸­å¤®é…ç½®ï¼‰
      let imgHtml = '';
      if (imageUrl && imageUrl.trim()) {
        imgHtml = `<img src="${imageUrl}" class="w-full h-auto max-h-full object-contain" alt="${card.skill_name}">`;
      } else {
        imgHtml = `<div class="text-white/20"><svg class="w-10 h-10" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path></svg></div>`;
      }

      // å‰Šé™¤ãƒœã‚¿ãƒ³ï¼ˆãƒã‚¤ã‚«ãƒ¼ãƒ‰ç”¨ï¼‰ - handId ã‚’åˆ©ç”¨
      const deleteBtn = showDelete && card.handId ? `
        <button type="button" data-delete="${card.handId}" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-lg z-30 hover:bg-red-600 transition-colors">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
      ` : '';

      const gradient = colorGradients[card.color] || colorGradients.purple;

      // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰ã¨åŒã˜æ§‹é€ ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆãƒŸãƒ‹ç‰ˆï¼‰
      return `
        ${deleteBtn}
        <div class="h-full flex flex-col overflow-hidden">
          <div class="relative flex flex-col" style="height: 70%;">
            <!-- åˆ†é¡ãƒ©ãƒ™ãƒ«ã‚’ä¸Šéƒ¨ã«é…ç½®ã—ã¦ã‚¤ãƒ©ã‚¹ãƒˆã¨é‡ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ -->
            <div class="flex items-start justify-end px-2 pt-1 pb-1">
              <span class="${categoryPadding} py-0.5 rounded-full ${categoryFont} font-bold text-white shadow-md" style="background: ${gradient}">
                ${card.shape} ${card.skill_category}
              </span>
            </div>

            <div class="flex-1 flex items-start justify-center px-3 pt-1 pb-1 bg-white/10" style="min-height: 0;">
              <div class="w-full h-full flex items-start justify-center">
                ${imgHtml}
              </div>
            </div>

            <div class="text-center ${nameAreaPadding} flex flex-col justify-end" style="min-height: ${titleHeight}; flex-shrink: 0;">
              <p class="title-font font-bold ${nameFont} ${CARD_DESIGN.nameClass} leading-tight line-clamp-2">${card.skill_name}</p>
              ${(card.formal_name || card.skill_formal_name || '').trim() ? `<p class="title-font ${size === 'grid' ? 'text-xs' : 'text-sm'} text-gray-600 mt-0.5 line-clamp-1">${card.formal_name || card.skill_formal_name || ''}</p>` : ''}
            </div>
          </div>

          <div class="border-t-3 border-[#d4af37]" style="border-top-width: 2px; flex-shrink: 0;"></div>

          <div class="flex flex-col" style="height: 30%;">
            <div class="flex-1 flex items-center justify-center text-center px-3 py-1" style="min-height: 0;">
              <p class="${descClass} ${CARD_DESIGN.descClass} text-center">
                ${description}
              </p>
            </div>
            <div class="px-3 pb-2" style="flex-shrink: 0;">
              <div class="bg-gray-800/90 rounded-md ${skillBoxPadding} border border-gray-600">
                <p class="${skillLabelClass} text-gray-300 mb-0.5 font-medium">ğŸ¯ ã‚¹ã‚­ãƒ«ä¾‹</p>
                <p class="${skillTextClass} text-gray-100">
                  ${hint || 'ã‚¹ã‚­ãƒ«ä¾‹ã¯ã‚ã‚Šã¾ã›ã‚“'}
                </p>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    let config = { ...defaultConfig };
    let registeredCards = [];
    let currentCard = null;
    let isFlipped = false;
    let handCards = JSON.parse(localStorage.getItem('handCards') || '[]');
    let isLoading = false;
    let selectedCategory = 'all';
    let allCardsFilter = 'all';

    const elements = {
      appTitle: document.getElementById('app-title'),
      drawSampleBtn: document.getElementById('draw-sample-btn'),
      cardPlaceholder: document.getElementById('card-placeholder'),
      cardDisplay: document.getElementById('card-display'),
      cardInner: document.getElementById('card-inner'),
      cardFront: document.getElementById('card-front'),
      cardCategory: document.getElementById('card-category'),
      cardName: document.getElementById('card-name'),
      cardFormalName: document.getElementById('card-formal-name'),
      cardDescription: document.getElementById('card-description'),
      cardHint: document.getElementById('card-hint'),
      cardActions: document.getElementById('card-actions'),
      addToHandBtn: document.getElementById('add-to-hand-btn'),
      returnToDeckBtn: document.getElementById('return-to-deck-btn'),
      handCards: document.getElementById('hand-cards'),
      handCount: document.getElementById('hand-count'),
      handEmpty: document.getElementById('hand-empty'),
      myCardsLabel: document.getElementById('my-cards-label'),
      allCardsToggle: document.getElementById('all-cards-toggle'),
      allCardsContent: document.getElementById('all-cards-content'),
      allCardsArrow: document.getElementById('all-cards-arrow'),
      allCardsGrid: document.getElementById('all-cards-grid'),
      allCardsCount: document.getElementById('all-cards-count'),
      loadingOverlay: document.getElementById('loading-overlay'),
      toastContainer: document.getElementById('toast-container'),
      importHandFile: document.getElementById('import-hand-file'),
      exportHandJson: document.getElementById('export-hand-json')
    };

    document.getElementById('popup-overlay')?.querySelector('.popup-card').style.setProperty('background', CARD_DESIGN.background);

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast px-4 py-3 rounded-lg shadow-lg ${
        type === 'success' ? 'bg-green-600' : 
        type === 'error' ? 'bg-red-600' : 
        'bg-yellow-600'
      }`;
      toast.textContent = message;
      elements.toastContainer.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function setLoading(loading) {
      isLoading = loading;
      elements.loadingOverlay.classList.toggle('hidden', !loading);
    }

    function drawCard(card) {
      currentCard = card;
      isFlipped = false;
      
      const gradient = colorGradients[card.color] || colorGradients.purple;
      elements.cardFront.style.background = CATEGORY_BACKGROUNDS[card.skill_category] || CARD_DESIGN.background;
      
      const cardImage = document.getElementById('card-image');
      
      if (card.image_url && card.image_url.trim()) {
        cardImage.src = card.image_url;
        cardImage.style.display = 'block';
      } else {
        cardImage.style.display = 'none';
      }
      
      elements.cardCategory.textContent = `${card.shape} ${card.skill_category}`;
      elements.cardCategory.style.background = gradient;
      elements.cardCategory.style.color = '#ffffff';
      elements.cardName.textContent = card.skill_name;
      if (elements.cardFormalName) elements.cardFormalName.textContent = card.formal_name || '';
      elements.cardDescription.textContent = card.description;
      elements.cardHint.textContent = card.hint || 'ã‚¹ã‚­ãƒ«ä¾‹ã¯ã‚ã‚Šã¾ã›ã‚“';
      
      elements.cardPlaceholder.classList.add('hidden');
      elements.cardDisplay.classList.remove('hidden');
      elements.cardInner.classList.remove('flipped');
      elements.cardDisplay.classList.remove('draw-animation');
      void elements.cardDisplay.offsetWidth;
      elements.cardDisplay.classList.add('draw-animation');
      elements.cardActions.classList.remove('hidden');
    }

    function flipCard() {
      isFlipped = !isFlipped;
      elements.cardInner.classList.toggle('flipped', isFlipped);
    }

    function returnToDeck() {
      currentCard = null;
      isFlipped = false;
      elements.cardDisplay.classList.add('hidden');
      elements.cardPlaceholder.classList.remove('hidden');
      elements.cardActions.classList.add('hidden');
      elements.cardInner.classList.remove('flipped');
    }

    function addToHand() {
      if (!currentCard) return;
      
      const cardToAdd = {
        ...currentCard,
        handId: Date.now().toString(),
        formal_name: (currentCard.formal_name || currentCard.skill_formal_name || '').trim()
      };
      
      handCards.push(cardToAdd);
      localStorage.setItem('handCards', JSON.stringify(handCards));
      renderHand();
      showToast(`ã€Œ${currentCard.skill_name}ã€ã‚’ãƒã‚¤ã‚«ãƒ¼ãƒ‰ã«åŠ ãˆã¾ã—ãŸ`);
      returnToDeck();
    }

    function removeFromHand(handId) {
      const card = handCards.find(c => c.handId === handId);
      handCards = handCards.filter(c => c.handId !== handId);
      localStorage.setItem('handCards', JSON.stringify(handCards));
      renderHand();
      if (card) {
        showToast(`ã€Œ${card.skill_name}ã€ã‚’ãƒã‚¤ã‚«ãƒ¼ãƒ‰ã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸ`);
      }
    }

    function renderHand() {
      const countText = `(${handCards.length}æš)`;
      elements.handCount.textContent = countText;
      
      if (handCards.length === 0) {
        elements.handEmpty.classList.remove('hidden');
        const cards = elements.handCards.querySelectorAll('.my-card-item');
        cards.forEach(c => c.remove());
        return;
      }
      
      elements.handEmpty.classList.add('hidden');
      
      const existingCards = new Map();
      elements.handCards.querySelectorAll('.my-card-item').forEach(el => {
        existingCards.set(el.dataset.handId, el);
      });
      
      handCards.forEach((card, index) => {
        if (existingCards.has(card.handId)) {
          existingCards.delete(card.handId);
        } else {
          const cardEl = document.createElement('div');
          cardEl.className = 'my-card-item relative shadow-2xl';
          // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰ã¨åŒã˜ 2:3ï¼ˆç¸¦é•·ï¼‰æ¯”ç‡ã«è¿‘ã¥ã‘ã‚‹
          cardEl.style.width = '180px';
          cardEl.style.height = '270px';
          cardEl.style.background = CATEGORY_BACKGROUNDS[card.skill_category] || CARD_DESIGN.background;
          cardEl.style.border = CARD_DESIGN.border;
          cardEl.style.boxShadow = CARD_DESIGN.boxShadow;
          
          const rotation = (index % 3 - 1) * 3;
          cardEl.style.transform = `rotate(${rotation}deg)`;
          
          cardEl.dataset.handId = card.handId;
          cardEl.innerHTML = createCardHtml(card, { size: 'hand', showDeleteButton: true });
          
          cardEl.addEventListener('click', (e) => {
            const deleteBtn = e.target.closest('[data-delete]');
            if (deleteBtn) {
              e.stopPropagation();
              removeFromHand(deleteBtn.dataset.delete);
            } else {
              showPopup(card);
            }
          });
          
          elements.handCards.appendChild(cardEl);
        }
      });
      
      existingCards.forEach(el => el.remove());
    }

    function renderAllCardsGrid() {
      const allCards = sampleCards;
      const filteredCards = allCardsFilter === 'all' 
        ? allCards 
        : allCards.filter(card => card.skill_category === allCardsFilter);
      
      const countText = `(${allCards.length}æš)`;
      elements.allCardsCount.textContent = countText;
      
      elements.allCardsGrid.innerHTML = '';
      
      const categories = [
        'æ€è€ƒï¼ˆæ¯”è¼ƒç³»ï¼‰',
        'æ€è€ƒï¼ˆåˆ†è§£â†”çµ±åˆç³»ï¼‰',
        'æ€è€ƒï¼ˆå¤šé¢ãƒ»å¤šè§’ç³»ï¼‰',
        'æ€è€ƒï¼ˆç‰¹æ®Šç³»ï¼‰',
        'å­¦ã³æ–¹',
        'è¨€èª',
        'æƒ…å ±',
        'å”åƒ'
      ];
      
      const groupedCards = {};
      
      categories.forEach(cat => {
        groupedCards[cat] = filteredCards.filter(card => card.skill_category === cat);
      });
      
      categories.forEach(category => {
        const cardsInCategory = groupedCards[category];
        if (cardsInCategory.length === 0) return;
        
        const headerEl = document.createElement('div');
        headerEl.className = 'col-span-full flex items-center gap-3 mt-4 mb-2';
        headerEl.innerHTML = `
          <div class="flex items-center gap-2 text-lg font-bold text-yellow-400">
            <span>${cardsInCategory[0].shape}</span>
            <span>${category}</span>
            <span class="text-sm text-gray-400">(${cardsInCategory.length}æš)</span>
          </div>
          <div class="flex-1 h-[2px] bg-gradient-to-r from-yellow-400/50 to-transparent"></div>
        `;
        elements.allCardsGrid.appendChild(headerEl);
        
        cardsInCategory.forEach(card => {
          const cardEl = document.createElement('div');
          // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚«ãƒ¼ãƒ‰ã«åˆã‚ã›ã¦ 2:3 ã®ç¸¦æ¨ªæ¯”ã«å¤‰æ›´
          cardEl.className = 'grid-card-item shadow-lg overflow-hidden aspect-[2/3]';
          cardEl.style.background = CATEGORY_BACKGROUNDS[card.skill_category] || CARD_DESIGN.background;
          cardEl.style.border = CARD_DESIGN.borderGrid;
          cardEl.style.boxShadow = CARD_DESIGN.boxShadowGrid;
          cardEl.innerHTML = createCardHtml(card, { size: 'grid', showDeleteButton: false });
          
          cardEl.addEventListener('click', () => {
            showPopup(card);
          });
          
          elements.allCardsGrid.appendChild(cardEl);
        });
      });
    }

    async function deleteCard(card) {
      if (isLoading) return;
      
      setLoading(true);
      const result = await window.dataSdk.delete(card);
      setLoading(false);
      
      if (result.isOk) {
        showToast(`ã€Œ${card.skill_name}ã€ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);
      } else {
        showToast('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    async function addCard(cardData) {
      if (registeredCards.length >= 999) {
        showToast('ã‚«ãƒ¼ãƒ‰ã¯999æšã¾ã§ç™»éŒ²ã§ãã¾ã™', 'warning');
        return false;
      }
      
      setLoading(true);
      const result = await window.dataSdk.create({
        ...cardData,
        created_at: new Date().toISOString()
      });
      setLoading(false);
      
      if (result.isOk) {
        showToast(`ã€Œ${cardData.skill_name}ã€ã‚’è¿½åŠ ã—ã¾ã—ãŸ`);
        return true;
      } else {
        showToast('è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        return false;
      }
    }

    async function addSampleCards() {
      if (registeredCards.length + sampleCards.length > 999) {
        showToast('ã‚«ãƒ¼ãƒ‰ã¯999æšã¾ã§ç™»éŒ²ã§ãã¾ã™', 'warning');
        return;
      }
      
      setLoading(true);
      let added = 0;
      
      for (const card of sampleCards) {
        const result = await window.dataSdk.create({
          ...card,
          created_at: new Date().toISOString()
        });
        if (result.isOk) added++;
      }
      
      setLoading(false);
      showToast(`${added}ç¨®ã®ã‚µãƒ³ãƒ—ãƒ«ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã—ãŸ`);
    }

    async function importCSV(file) {
      const text = await file.text();
      const lines = text.split('\n').filter(line => line.trim());
      
      if (lines.length < 2) {
        showToast('CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒç©ºã¾ãŸã¯ç„¡åŠ¹ã§ã™', 'error');
        return;
      }
      
      const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
      const requiredHeaders = ['skill_name', 'skill_category', 'description'];
      
      if (!requiredHeaders.every(h => headers.includes(h))) {
        showToast('å¿…é ˆã®åˆ—ãŒä¸è¶³ã—ã¦ã„ã¾ã™', 'error');
        return;
      }
      
      const cards = [];
      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(',');
        if (values.length < headers.length) continue;
        
        const card = {};
        headers.forEach((h, idx) => {
          card[h] = values[idx]?.trim() || '';
        });
        
        if (card.skill_name && card.skill_category && card.description) {
          cards.push({
            skill_name: card.skill_name,
            formal_name: card.formal_name || '',
            skill_category: card.skill_category,
            description: card.description,
            hint: card.hint || '',
            shape: card.shape || 'â—',
            color: card.color || 'purple'
          });
        }
      }
      
      if (cards.length === 0) {
        showToast('æœ‰åŠ¹ãªã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
        return;
      }
      
      if (registeredCards.length + cards.length > 999) {
        showToast('ã‚«ãƒ¼ãƒ‰ã¯999æšã¾ã§ç™»éŒ²ã§ãã¾ã™', 'warning');
        return;
      }
      
      setLoading(true);
      let added = 0;
      
      for (const card of cards) {
        const result = await window.dataSdk.create({
          ...card,
          created_at: new Date().toISOString()
        });
        if (result.isOk) added++;
      }
      
      setLoading(false);
      showToast(`${added}æšã®ã‚«ãƒ¼ãƒ‰ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ`);
    }

    function downloadSampleCSV() {
      const csv = `skill_name,formal_name,skill_category,description,hint,shape,color
åŒç•°ç‚¹æ¯”è¼ƒ,,æ€è€ƒï¼ˆæ¯”è¼ƒç³»ï¼‰,æ¯”ã¹ã‚‹ã“ã¨ã§ã€ã¡ãŒã„ã¨å…±é€šç‚¹ã‚’è¦‹ã¤ã‘ã‚‹ãªã©ã€æ•´ç†ã™ã‚‹åŠ›,åŒç•°ç‚¹æ¯”è¼ƒï¼åˆ†é¡ï¼é–¢é€£ã¥ã‘,â– ,orange
é †åºã¥ã‘,,æ€è€ƒï¼ˆåˆ†è§£â†”çµ±åˆç³»ï¼‰,ãƒãƒ©ã—ãŸã‚Šçµ„ã¿ç«‹ã¦ãŸã‚Šã—ã¦ã€ç­‹é“ç«‹ã¦ã‚‹åŠ›,é †åºã¥ã‘ï¼ç†ç”±ã¥ã‘ï¼å…·ä½“åŒ–,â–²,blue`;
      
      const dataUrl = 'data:text/csv;charset=utf-8,%EF%BB%BF' + encodeURIComponent(csv);
      const link = document.createElement('a');
      link.href = dataUrl;
      link.download = 'skill_cards_sample.csv';
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.click();
      showToast('CSVã‚µãƒ³ãƒ—ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
    }

    function updateUI() {
      elements.appTitle.textContent = config.app_title || defaultConfig.app_title;
      elements.drawSampleBtn.textContent = config.draw_sample_btn || defaultConfig.draw_sample_btn;
      elements.addToHandBtn.textContent = config.add_to_hand_btn || defaultConfig.add_to_hand_btn;
      elements.returnToDeckBtn.textContent = config.return_to_deck_btn || defaultConfig.return_to_deck_btn;
      elements.myCardsLabel.textContent = config.my_cards_label || defaultConfig.my_cards_label;
      applyCardBackImage();
    }

    function applyCardBackImage() {
      const url = String(config?.card_back_image_url ?? defaultConfig.card_back_image_url ?? '').trim();
      const placeholderImg = document.getElementById('card-placeholder-back-img');
      const placeholderFallback = document.getElementById('card-placeholder-back-fallback');
      const backImg = document.getElementById('card-back-img');
      const backFallback = document.getElementById('card-back-fallback');
      const showImage = (img, fallback) => {
        if (img && fallback) {
          img.style.display = 'block';
          fallback.style.display = 'none';
        }
      };
      const showFallback = (img, fallback) => {
        if (img && fallback) {
          img.style.display = 'none';
          fallback.style.display = 'block';
        }
      };
      if (!url) {
        showFallback(placeholderImg, placeholderFallback);
        showFallback(backImg, backFallback);
        return;
      }
      const imgs = [placeholderImg, backImg].filter(Boolean);
      if (imgs.length === 0) return;
      let loadedCount = 0;
      const tryShowImages = () => {
        loadedCount++;
        if (loadedCount >= imgs.length) {
          showImage(placeholderImg, placeholderFallback);
          showImage(backImg, backFallback);
        }
      };
      imgs.forEach(img => {
        img.src = url;
        img.onload = tryShowImages;
        img.onerror = () => {
          showFallback(placeholderImg, placeholderFallback);
          showFallback(backImg, backFallback);
        };
      });
      setTimeout(() => {
        if (imgs.every(i => i.complete && i.naturalWidth > 0)) {
          showImage(placeholderImg, placeholderFallback);
          showImage(backImg, backFallback);
        }
      }, 0);
    }

    function normalizeHandCard(raw) {
      return {
        ...raw,
        handId: (raw.handId && typeof raw.handId === 'string') ? raw.handId : Date.now().toString() + '_' + Math.random().toString(36).slice(2),
        skill_name: raw.skill_name || raw.name || '',
        formal_name: (raw.formal_name || raw.skill_formal_name || '').trim(),
        skill_category: raw.skill_category || raw.category || '',
        description: raw.description || '',
        hint: raw.hint || '',
        shape: raw.shape || 'â—',
        color: raw.color || 'purple',
        image_url: raw.image_url || raw.skill_image_url || ''
      };
    }

    function importHandFromFile(file) {
      if (!file) return;
      const isJson = /\.json$/i.test(file.name);
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const text = (e.target?.result || '').toString().trim();
          let cards = [];
          if (isJson) {
            const data = JSON.parse(text);
            cards = Array.isArray(data) ? data : (data.cards ? data.cards : [data]);
          } else {
            const parseCsvLine = (line) => {
              const out = [];
              let i = 0;
              while (i < line.length) {
                if (line[i] === '"') {
                  let s = '';
                  i++;
                  while (i < line.length) {
                    if (line[i] === '"' && line[i + 1] === '"') { s += '"'; i += 2; }
                    else if (line[i] === '"') { i++; break; }
                    else { s += line[i]; i++; }
                  }
                  out.push(s.trim());
                } else {
                  let s = '';
                  while (i < line.length && line[i] !== ',') { s += line[i]; i++; }
                  out.push(s.trim());
                  if (line[i] === ',') i++;
                }
              }
              return out;
            };
            const lines = text.split(/\r?\n/).filter(l => l.trim());
            if (lines.length < 2) {
              showToast('CSVã«1è¡Œä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
              return;
            }
            const headers = parseCsvLine(lines[0]).map(h => h.trim().toLowerCase());
            const need = ['skill_name', 'skill_category', 'description'];
            if (!need.every(h => headers.includes(h))) {
              showToast('CSVã«å¿…é ˆåˆ—ï¼ˆskill_name, skill_category, descriptionï¼‰ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
              return;
            }
            for (let i = 1; i < lines.length; i++) {
              const values = parseCsvLine(lines[i]);
              const card = {};
              headers.forEach((h, idx) => { card[h] = (values[idx] || '').trim(); });
              if (card.skill_name && card.skill_category && card.description) {
                cards.push({
                  skill_name: card.skill_name,
                  formal_name: card.formal_name || '',
                  skill_category: card.skill_category,
                  description: card.description,
                  hint: card.hint || '',
                  shape: card.shape || 'â—',
                  color: card.color || 'purple',
                  image_url: card.image_url || card.skill_image_url || ''
                });
              }
            }
          }
          if (cards.length === 0) {
            showToast('æœ‰åŠ¹ãªã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“', 'error');
            return;
          }
          handCards = cards.map((c, i) => normalizeHandCard({ ...c, handId: `import_${Date.now()}_${i}` }));
          localStorage.setItem('handCards', JSON.stringify(handCards));
          renderHand();
          showToast(`ãƒã‚¤ã‚«ãƒ¼ãƒ‰ã«${handCards.length}æšèª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
        } catch (err) {
          console.error(err);
          showToast('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        }
        elements.importHandFile.value = '';
      };
      reader.readAsText(file, 'UTF-8');
    }

    function exportHandJSON() {
      if (handCards.length === 0) {
        showToast('ãƒã‚¤ã‚«ãƒ¼ãƒ‰ãŒç©ºã§ã™', 'warning');
        return;
      }
      
      const exportData = handCards.map(card => ({
        skill_name: card.skill_name,
        formal_name: card.formal_name || '',
        skill_category: card.skill_category,
        description: card.description,
        hint: card.hint || '',
        shape: card.shape,
        color: card.color,
        image_url: card.image_url || card.skill_image_url || ''
      }));
      
      const json = JSON.stringify(exportData, null, 2);
      const dataUrl = 'data:application/json;charset=utf-8,' + encodeURIComponent(json);
      const link = document.createElement('a');
      link.href = dataUrl;
      link.download = `my_cards_${new Date().toISOString().split('T')[0]}.json`;
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.click();
      showToast('ãƒã‚¤ã‚«ãƒ¼ãƒ‰ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
    }

    function exportRegisteredCSV() {
      if (registeredCards.length === 0) {
        showToast('ç™»éŒ²ã‚«ãƒ¼ãƒ‰ãŒç©ºã§ã™', 'warning');
        return;
      }
      
      const quote = (s) => (s == null ? '' : String(s)).includes(',') || String(s).includes('"') ? '"' + String(s).replace(/"/g, '""') + '"' : String(s);
      const headers = 'skill_name,formal_name,skill_category,description,hint,shape,color,image_url\n';
      const rows = registeredCards.map(card =>
        [card.skill_name, card.formal_name || '', card.skill_category, card.description, card.hint || '', card.shape, card.color, card.image_url || card.skill_image_url || ''].map(quote).join(',')
      ).join('\n');
      
      const csv = headers + rows;
      const dataUrl = 'data:text/csv;charset=utf-8,%EF%BB%BF' + encodeURIComponent(csv);
      const link = document.createElement('a');
      link.href = dataUrl;
      link.download = `registered_cards_${new Date().toISOString().split('T')[0]}.csv`;
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.click();
      showToast('ç™»éŒ²ã‚«ãƒ¼ãƒ‰ã‚’CSVå‡ºåŠ›ã—ã¾ã—ãŸ');
    }

    function exportRegisteredJSON() {
      if (registeredCards.length === 0) {
        showToast('ç™»éŒ²ã‚«ãƒ¼ãƒ‰ãŒç©ºã§ã™', 'warning');
        return;
      }
      
      const exportData = registeredCards.map(card => ({
        skill_name: card.skill_name,
        formal_name: card.formal_name || '',
        skill_category: card.skill_category,
        description: card.description,
        hint: card.hint || '',
        shape: card.shape,
        color: card.color,
        image_url: card.image_url || card.skill_image_url || ''
      }));
      
      const json = JSON.stringify(exportData, null, 2);
      const dataUrl = 'data:application/json;charset=utf-8,' + encodeURIComponent(json);
      const link = document.createElement('a');
      link.href = dataUrl;
      link.download = `registered_cards_${new Date().toISOString().split('T')[0]}.json`;
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.click();
      showToast('ç™»éŒ²ã‚«ãƒ¼ãƒ‰ã‚’JSONå‡ºåŠ›ã—ã¾ã—ãŸ');
    }
    
    function showPopup(card) {
      const popupOverlay = document.getElementById('popup-overlay');
      const popupCategory = document.getElementById('popup-category');
      const popupImage = document.getElementById('popup-image');
      const popupName = document.getElementById('popup-name');
      const popupFormalName = document.getElementById('popup-formal-name');
      const popupDescription = document.getElementById('popup-description');
      const popupHint = document.getElementById('popup-hint');
      const popupCard = document.querySelector('.popup-card');
popupCard.style.background = CATEGORY_BACKGROUNDS[card.skill_category] || CARD_DESIGN.background;
      
      const gradient = colorGradients[card.color] || colorGradients.purple;
      
      popupCategory.textContent = `${card.shape} ${card.skill_category}`;
      popupCategory.style.background = gradient;
      
      if (card.image_url && card.image_url.trim()) {
        popupImage.src = card.image_url;
        popupImage.style.display = 'block';
      } else {
        popupImage.style.display = 'none';
      }
      
      popupName.textContent = card.skill_name;
      if (popupFormalName) popupFormalName.textContent = (card.formal_name || card.skill_formal_name || '').trim();
      popupDescription.textContent = card.description;
      popupHint.textContent = card.hint || 'ã‚¹ã‚­ãƒ«ä¾‹ã¯ã‚ã‚Šã¾ã›ã‚“';
      
      popupOverlay.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
    
    function hidePopup() {
      const popupOverlay = document.getElementById('popup-overlay');
      popupOverlay.classList.add('hidden');
      document.body.style.overflow = '';
    }

    const dataHandler = {
      onDataChanged(data) {
        registeredCards = data;
      }
    };

    async function initElementSDK() {
      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (newConfig) => {
            config = { ...defaultConfig, ...newConfig };
            updateUI();
          },
          mapToCapabilities: (cfg) => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ['app_title', cfg.app_title || defaultConfig.app_title],
            ['draw_sample_btn', cfg.draw_sample_btn || defaultConfig.draw_sample_btn],
            ['add_to_hand_btn', cfg.add_to_hand_btn || defaultConfig.add_to_hand_btn],
            ['return_to_deck_btn', cfg.return_to_deck_btn || defaultConfig.return_to_deck_btn],
            ['my_cards_label', cfg.my_cards_label || defaultConfig.my_cards_label]
          ])
        });
        config = { ...defaultConfig, ...window.elementSdk.config };
      }
    }

    function getCategoryShapeAndColor(category) {
      const categoryMap = {
        'æ€è€ƒï¼ˆæ¯”è¼ƒç³»ï¼‰': { shape: 'â– ', color: 'orange' },
        'æ€è€ƒï¼ˆåˆ†è§£â†”çµ±åˆç³»ï¼‰': { shape: 'â–²', color: 'blue' },
        'æ€è€ƒï¼ˆå¤šé¢ãƒ»å¤šè§’ç³»ï¼‰': { shape: 'â—', color: 'pink' },
        'æ€è€ƒï¼ˆç‰¹æ®Šç³»ï¼‰': { shape: 'â˜…', color: 'purple' },
        'å­¦ã³æ–¹': { shape: 'â™¤', color: 'red' },
        'è¨€èª': { shape: 'â™§', color: 'green' },
        'æƒ…å ±': { shape: 'â™¢', color: 'cyan' },
        'å”åƒ': { shape: 'â™¡', color: 'yellow' }
      };
      
      return categoryMap[category] || { shape: 'â—', color: 'purple' };
    }

    function setupEventListeners() {
      document.querySelectorAll('.category-filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.category-filter-btn').forEach(b => {
            b.classList.remove('active', 'bg-yellow-600', 'hover:bg-yellow-700');
            b.classList.add('bg-gray-700', 'hover:bg-gray-600');
          });
          btn.classList.add('active', 'bg-yellow-600', 'hover:bg-yellow-700');
          btn.classList.remove('bg-gray-700', 'hover:bg-gray-600');
          selectedCategory = btn.dataset.category;
        });
      });
      
      document.querySelectorAll('.all-cards-filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.all-cards-filter-btn').forEach(b => {
            b.classList.remove('active', 'bg-purple-600', 'hover:bg-purple-700');
            b.classList.add('bg-gray-700', 'hover:bg-gray-600');
          });
          btn.classList.add('active', 'bg-purple-600', 'hover:bg-purple-700');
          btn.classList.remove('bg-gray-700', 'hover:bg-gray-600');
          allCardsFilter = btn.dataset.filter;
          renderAllCardsGrid();
        });
      });
      
      elements.allCardsToggle.addEventListener('click', () => {
        const isHidden = elements.allCardsContent.classList.contains('hidden');
        elements.allCardsContent.classList.toggle('hidden');
        elements.allCardsArrow.style.transform = isHidden ? 'rotate(180deg)' : '';
      });
      
      elements.drawSampleBtn.addEventListener('click', () => {
        const filteredCards = selectedCategory === 'all' 
          ? sampleCards 
          : sampleCards.filter(card => card.skill_category === selectedCategory);
        
        if (filteredCards.length === 0) {
          showToast(`${selectedCategory}ã®ã‚«ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“`, 'warning');
          return;
        }
        
        const randomCard = filteredCards[Math.floor(Math.random() * filteredCards.length)];
        drawCard(randomCard);
      });
      
      elements.addToHandBtn.addEventListener('click', addToHand);
      elements.returnToDeckBtn.addEventListener('click', returnToDeck);
      
      elements.importHandFile.addEventListener('change', (e) => {
        const file = e.target.files?.[0];
        if (file) importHandFromFile(file);
      });
      elements.exportHandJson.addEventListener('click', exportHandJSON);
      
      document.getElementById('popup-close').addEventListener('click', hidePopup);
      document.getElementById('popup-overlay').addEventListener('click', (e) => {
        if (e.target.id === 'popup-overlay') {
          hidePopup();
        }
      });
    }

    async function init() {
      await initElementSDK();
      updateUI();
      renderHand();
      renderAllCardsGrid();
      
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          showToast('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        }
      }
      
      setupEventListeners();
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c771ac6a514fc98',t:'MTc3MDAwODIxNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>